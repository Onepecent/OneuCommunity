

![image-20210706221049662](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210706221049662.png)



## 技术栈

| 技术              | 链接                                                         |
| ----------------- | ------------------------------------------------------------ |
| Spring Boot       | http://projects.spring.io/spring-boot/#quick-start           |
| MyBatis           | https://mybatis.org/mybatis-3/zh/index.html                  |
| MyBatis Generator | http://mybatis.org/generator/                                |
| H2                | http://www.h2database.com/html/main.html                     |
| Flyway            | https://flywaydb.org/getstarted/firststeps/maven             |
| Lombok            | https://www.projectlombok.org                                |
| Bootstrap         | https://v3.bootcss.com/getting-started/                      |
| Github OAuth      | https://developer.github.com/apps/building-oauth-apps/creating-an-oauth-app/ |
| MySQL             | 略                                                           |
| Bootstrap         | https://v3.bootcss.com/getting-started/                      |

## 扩展资料(使用了部分)

[Spring 文档](https://spring.io/guides)    
[Spring Web](https://spring.io/guides/gs/serving-web-content/)   
[es](https://elasticsearch.cn/explore)    
[Github deploy key](https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys)    
[Bootstrap](https://v3.bootcss.com/getting-started/)    
[Github OAuth](https://developer.github.com/apps/building-oauth-apps/creating-an-oauth-app/)    
[Spring](https://docs.spring.io/spring-boot/docs/2.0.0.RC1/reference/htmlsingle/#boot-features-embedded-database-support)    
[菜鸟教程](https://www.runoob.com/mysql/mysql-insert-query.html)    
[Thymeleaf](https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#setting-attribute-values)    
[Spring Dev Tool](https://docs.spring.io/spring-boot/docs/2.0.0.RC1/reference/htmlsingle/#using-boot-devtools)  
[Spring MVC](https://docs.spring.io/spring/docs/5.0.3.RELEASE/spring-framework-reference/web.html#mvc-handlermapping-interceptor)  
[Markdown 插件](http://editor.md.ipandao.com/)   
[UFfile SDK](https://github.com/ucloud/ufile-sdk-java)  
[Count(*) VS Count(1)](https://mp.weixin.qq.com/s/Rwpke4BHu7Fz7KOpE2d3Lw)  
[Git](https://git-scm.com/download)   
[Visual Paradigm](https://www.visual-paradigm.com)    
[Flyway](https://flywaydb.org/getstarted/firststeps/maven)  
[Lombok](https://www.projectlombok.org)    
[ctotree](https://www.octotree.io/)   
[Table of content sidebar](https://chrome.google.com/webstore/detail/table-of-contents-sidebar/ohohkfheangmbedkgechjkmbepeikkej)    
[One Tab](https://chrome.google.com/webstore/detail/chphlpgkkbolifaimnlloiipkdnihall)    
[Live Reload](https://chrome.google.com/webstore/detail/livereload/jnihajbhpnppcggbcgedagnkighmdlei/related)  
[Postman](https://chrome.google.com/webstore/detail/coohjcphdfgbiolnekdpbcijmhambjff)





# 开发过程（部分）

# Authorizing OAuth Apps

## 登录图

!(C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210619202551154.png)

![image-20210706193833747](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210706193833747.png)

### [Web application flow](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#web-application-flow)

The web application flow to authorize users for your app is:

1. Users are redirected to request their GitHub identity
2. Users are redirected back to your site by GitHub
3. Your app accesses the API with the user's access token

### [1. Request a user's GitHub identity](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#1-request-a-users-github-identity)

```
GET https://github.com/login/oauth/authorize
```

When your GitHub App specifies a `login` parameter, it prompts users with a specific account they can use for signing in and authorizing your app.

### [Parameters](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#parameters)

| Name           | Type     | Description                                                  |
| :------------- | :------- | :----------------------------------------------------------- |
| `client_id`    | `string` | **Required**. The client ID you received from GitHub when you [registered](https://github.com/settings/applications/new). |
| `redirect_uri` | `string` | The URL in your application where users will be sent after authorization. See details below about [redirect urls](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#redirect-urls). |
| `login`        | `string` | Suggests a specific account to use for signing in and authorizing the app. |
| `scope`        | `string` | A space-delimited list of [scopes](https://docs.github.com/en/apps/building-oauth-apps/understanding-scopes-for-oauth-apps). If not provided, `scope` defaults to an empty list for users that have not authorized any scopes for the application. For users who have authorized scopes for the application, the user won't be shown the OAuth authorization page with the list of scopes. Instead, this step of the flow will automatically complete with the set of scopes the user has authorized for the application. For example, if a user has already performed the web flow twice and has authorized one token with `user` scope and another token with `repo` scope, a third web flow that does not provide a `scope` will receive a token with `user` and `repo` scope. |
| `state`        | `string` | An unguessable random string. It is used to protect against cross-site request forgery attacks. |
| `allow_signup` | `string` | Whether or not unauthenticated users will be offered an option to sign up for GitHub during the OAuth flow. The default is `true`. Use `false` when a policy prohibits signups. |

![image-20210619210943817](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210619210943817.png)

登录后:返回code

![image-20210619211221986](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210619211221986.png)



## provider包

​	表示第三方提供:

![image-20210620085652353](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210620085652353.png)

## dto(data translate object)

​	数据传输模型

![image-20210620085804543](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210620085804543.png)

# Okhttp

第一步导包:maven仓库

## Get a URL

```java
OkHttpClient client = new OkHttpClient();

String run(String url) throws IOException {
  Request request = new Request.Builder()
      .url(url)//请求的地址 "https://api.github.com/user?access_token="+accessToken
      .build();

  try (Response response = client.newCall(request).execute()) {
    return response.body().string();//response.body().string()<-响应的数据
  }
    //将json转回对象->GithubUser githubUser = JSON.parseObject(String类型,GithubUser.class);
}
```

## Post to a Server

```java
public static final MediaType mediaType = MediaType.get("application/json; charset=utf-8");

OkHttpClient client = new OkHttpClient();//

String post(String url, String json) throws IOException {
  RequestBody body = RequestBody.create(mediaType, json);//json数据可以用Alibaba的fastjson(需要导包)->JSON.toJSONString(对象)
  Request request = new Request.Builder()
      .url(url)
      .post(body)
      .build();//
  try (Response response = client.newCall(request).execute()) {
    return response.body().string();//response.body().string()<-响应的数据
  }
}
```



### [2. Users are redirected back to your site by GitHub](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#2-users-are-redirected-back-to-your-site-by-github)

If the user accepts your request, GitHub redirects back to your site with a temporary `code` in a code parameter as well as the state you provided in the previous step in a `state` parameter. The temporary code will expire after 10 minutes. If the states don't match, then a third party created the request, and you should abort the process.

Exchange this `code` for an access token:

```
POST https://github.com/login/oauth/access_token
```

#### [Parameters](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#parameters-1)

| Name            | Type     | Description                                                  |
| :-------------- | :------- | :----------------------------------------------------------- |
| `client_id`     | `string` | **Required.** The client ID you received from GitHub for your OAuth App. |
| `client_secret` | `string` | **Required.** The client secret you received from GitHub for your OAuth App. |
| `code`          | `string` | **Required.** The code you received as a response to Step 1. |
| `redirect_uri`  | `string` | The URL in your application where users are sent after authorization. |

#### [Response](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#response)

By default, the response takes the following form:

```
access_token=gho_16C7e42F292c6912E7710c838347Ae178B4a&token_type=bearer
```

You can also receive the content in different formats depending on the Accept header:

```
Accept: application/json
{"access_token":"gho_16C7e42F292c6912E7710c838347Ae178B4a", "scope":"repo,gist", "token_type":"bearer"}

Accept: application/xml
<OAuth>
  <token_type>bearer</token_type>
  <scope>repo,gist</scope>
  <access_token>gho_16C7e42F292c6912E7710c838347Ae178B4a</access_token>
</OAuth>
```

### [3. Use the access token to access the API](https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#3-use-the-access-token-to-access-the-api)

The access token allows you to make requests to the API on a behalf of a user.

```
Authorization: token OAUTH-TOKEN
GET https://api.github.com/user
```

For example, in curl you can set the Authorization header like this:

```shell
curl -H "Authorization: token OAUTH-TOKEN" https://api.github.com/user
```



# Session

​	存在服务器->银行中开的账户

# Cookie

​	存在客户端(浏览器)->比喻成银行卡



# 项目沟通图->数据库(UML规范)

## 画类图



## 数据库连接

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/oneucommunity?useUnicode=true&characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```



# themleaf

#### 地址拼接：

```html
@{地址/(参数=要传的参数)}
eg：
<a th:href="@{/(page=${page})}" th:text="${page}"></a>
@{'不变的地址'+${变化的地址参数}(参数=${参数})}
<a th:href="@{'/profile/'+${section}(page=${pagination.getPage()})}"></a>
```

#### 条件判断：

```html 
${判断条件} ? 'true':'false'
<li th:class="${pagination.getPage()==page} ? 'active':''"></li>
```



# jQuery导入问题

#### 已解决：GET http://localhost:8080/statics/js/jquery-3.4.1.js net::ERR_ABORTED 404

##### 导入js包后要clean项目，js才起作用

![img](https://img-blog.csdnimg.cn/20200816161658411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNjE5Mjcx,size_16,color_FFFFFF,t_70#pic_center)

![img](https://img-blog.csdnimg.cn/20200816161809183.png#pic_center)

# 1.11.2. MVC Config API

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-customize)

In Java configuration, you can implement the `WebMvcConfigurer` interface, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    // Implement configuration methods...
}
```

In XML, you can check attributes and sub-elements of `<mvc:annotation-driven/>`. You can view the [Spring MVC XML schema](https://schema.spring.io/mvc/spring-mvc.xsd) or use the code completion feature of your IDE to discover what attributes and sub-elements are available.

#### 1.11.3. Type Conversion

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-conversion)

By default, formatters for various number and date types are installed, along with support for customization via `@NumberFormat` and `@DateTimeFormat` on fields.

To register custom formatters and converters in Java config, use the following:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addFormatters(FormatterRegistry registry) {
        // ...
    }
}
```

To do the same in XML config, use the following:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        https://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <mvc:annotation-driven conversion-service="conversionService"/>

    <bean id="conversionService"
            class="org.springframework.format.support.FormattingConversionServiceFactoryBean">
        <property name="converters">
            <set>
                <bean class="org.example.MyConverter"/>
            </set>
        </property>
        <property name="formatters">
            <set>
                <bean class="org.example.MyFormatter"/>
                <bean class="org.example.MyAnnotationFormatterFactory"/>
            </set>
        </property>
        <property name="formatterRegistrars">
            <set>
                <bean class="org.example.MyFormatterRegistrar"/>
            </set>
        </property>
    </bean>

</beans>
```

By default Spring MVC considers the request Locale when parsing and formatting date values. This works for forms where dates are represented as Strings with "input" form fields. For "date" and "time" form fields, however, browsers use a fixed format defined in the HTML spec. For such cases date and time formatting can be customized as follows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addFormatters(FormatterRegistry registry) {
        DateTimeFormatterRegistrar registrar = new DateTimeFormatterRegistrar();
        registrar.setUseIsoFormat(true);
        registrar.registerFormatters(registry);
    }
}
```

|      | See [the `FormatterRegistrar` SPI](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#format-FormatterRegistrar-SPI) and the `FormattingConversionServiceFactoryBean` for more information on when to use FormatterRegistrar implementations. |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

#### 1.11.4. Validation

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-validation)

By default, if [Bean Validation](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validation-beanvalidation-overview) is present on the classpath (for example, Hibernate Validator), the `LocalValidatorFactoryBean` is registered as a global [Validator](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validator) for use with `@Valid` and `Validated` on controller method arguments.

In Java configuration, you can customize the global `Validator` instance, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public Validator getValidator() {
        // ...
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        https://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <mvc:annotation-driven validator="globalValidator"/>

</beans>
```

Note that you can also register `Validator` implementations locally, as the following example shows:

Java

Kotlin

```java
@Controller
public class MyController {

    @InitBinder
    protected void initBinder(WebDataBinder binder) {
        binder.addValidators(new FooValidator());
    }
}
```

|      | If you need to have a `LocalValidatorFactoryBean` injected somewhere, create a bean and mark it with `@Primary` in order to avoid conflict with the one declared in the MVC configuration. |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

#### 1.11.5. Interceptors

In Java configuration, you can register interceptors to apply to incoming requests, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleChangeInterceptor());
        registry.addInterceptor(new ThemeChangeInterceptor()).addPathPatterns("/**").excludePathPatterns("/admin/**");
        registry.addInterceptor(new SecurityInterceptor()).addPathPatterns("/secure/*");
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:interceptors>
    <bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"/>
    <mvc:interceptor>
        <mvc:mapping path="/**"/>
        <mvc:exclude-mapping path="/admin/**"/>
        <bean class="org.springframework.web.servlet.theme.ThemeChangeInterceptor"/>
    </mvc:interceptor>
    <mvc:interceptor>
        <mvc:mapping path="/secure/*"/>
        <bean class="org.example.SecurityInterceptor"/>
    </mvc:interceptor>
</mvc:interceptors>
```

#### 1.11.6. Content Types

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-content-negotiation)

You can configure how Spring MVC determines the requested media types from the request (for example, `Accept` header, URL path extension, query parameter, and others).

By default, the URL path extension is checked first — with `json`, `xml`, `rss`, and `atom` registered as known extensions (depending on classpath dependencies). The `Accept` header is checked second.

Consider changing those defaults to `Accept` header only, and, if you must use URL-based content type resolution, consider using the query parameter strategy over path extensions. See [Suffix Match](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-requestmapping-suffix-pattern-match) and [Suffix Match and RFD](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-requestmapping-rfd) for more details.

In Java configuration, you can customize requested content type resolution, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer.mediaType("json", MediaType.APPLICATION_JSON);
        configurer.mediaType("xml", MediaType.APPLICATION_XML);
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:annotation-driven content-negotiation-manager="contentNegotiationManager"/>

<bean id="contentNegotiationManager" class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean">
    <property name="mediaTypes">
        <value>
            json=application/json
            xml=application/xml
        </value>
    </property>
</bean>
```

#### 1.11.7. Message Converters

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-message-codecs)

You can customize `HttpMessageConverter` in Java configuration by overriding [`configureMessageConverters()`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html#configureMessageConverters-java.util.List-) (to replace the default converters created by Spring MVC) or by overriding [`extendMessageConverters()`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html#extendMessageConverters-java.util.List-) (to customize the default converters or add additional converters to the default ones).

The following example adds XML and Jackson JSON converters with a customized `ObjectMapper` instead of the default ones:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfiguration implements WebMvcConfigurer {

    @Override
    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
        Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder()
                .indentOutput(true)
                .dateFormat(new SimpleDateFormat("yyyy-MM-dd"))
                .modulesToInstall(new ParameterNamesModule());
        converters.add(new MappingJackson2HttpMessageConverter(builder.build()));
        converters.add(new MappingJackson2XmlHttpMessageConverter(builder.createXmlMapper(true).build()));
    }
}
```

In the preceding example, [`Jackson2ObjectMapperBuilder`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/http/converter/json/Jackson2ObjectMapperBuilder.html) is used to create a common configuration for both `MappingJackson2HttpMessageConverter` and `MappingJackson2XmlHttpMessageConverter` with indentation enabled, a customized date format, and the registration of [`jackson-module-parameter-names`](https://github.com/FasterXML/jackson-module-parameter-names), Which adds support for accessing parameter names (a feature added in Java 8).

This builder customizes Jackson’s default properties as follows:

- [`DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES`](https://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/DeserializationFeature.html#FAIL_ON_UNKNOWN_PROPERTIES) is disabled.
- [`MapperFeature.DEFAULT_VIEW_INCLUSION`](https://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/MapperFeature.html#DEFAULT_VIEW_INCLUSION) is disabled.

It also automatically registers the following well-known modules if they are detected on the classpath:

- [jackson-datatype-joda](https://github.com/FasterXML/jackson-datatype-joda): Support for Joda-Time types.
- [jackson-datatype-jsr310](https://github.com/FasterXML/jackson-datatype-jsr310): Support for Java 8 Date and Time API types.
- [jackson-datatype-jdk8](https://github.com/FasterXML/jackson-datatype-jdk8): Support for other Java 8 types, such as `Optional`.
- [`jackson-module-kotlin`](https://github.com/FasterXML/jackson-module-kotlin): Support for Kotlin classes and data classes.

|      | Enabling indentation with Jackson XML support requires [`woodstox-core-asl`](https://search.maven.org/#search|gav|1|g%3A"org.codehaus.woodstox" AND a%3A"woodstox-core-asl") dependency in addition to [`jackson-dataformat-xml`](https://search.maven.org/#search\|ga\|1\|a%3A"jackson-dataformat-xml") one. |
| ---- | ------------------------------------------------------------ |
|      |                                                              |

Other interesting Jackson modules are available:

- [jackson-datatype-money](https://github.com/zalando/jackson-datatype-money): Support for `javax.money` types (unofficial module).
- [jackson-datatype-hibernate](https://github.com/FasterXML/jackson-datatype-hibernate): Support for Hibernate-specific types and properties (including lazy-loading aspects).

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:annotation-driven>
    <mvc:message-converters>
        <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
            <property name="objectMapper" ref="objectMapper"/>
        </bean>
        <bean class="org.springframework.http.converter.xml.MappingJackson2XmlHttpMessageConverter">
            <property name="objectMapper" ref="xmlMapper"/>
        </bean>
    </mvc:message-converters>
</mvc:annotation-driven>

<bean id="objectMapper" class="org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean"
      p:indentOutput="true"
      p:simpleDateFormat="yyyy-MM-dd"
      p:modulesToInstall="com.fasterxml.jackson.module.paramnames.ParameterNamesModule"/>

<bean id="xmlMapper" parent="objectMapper" p:createXmlMapper="true"/>
```

#### 1.11.8. View Controllers

This is a shortcut for defining a `ParameterizableViewController` that immediately forwards to a view when invoked. You can use it in static cases when there is no Java controller logic to run before the view generates the response.

The following example of Java configuration forwards a request for `/` to a view called `home`:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("home");
    }
}
```

The following example achieves the same thing as the preceding example, but with XML, by using the `<mvc:view-controller>` element:

```xml
<mvc:view-controller path="/" view-name="home"/>
```

If an `@RequestMapping` method is mapped to a URL for any HTTP method then a view controller cannot be used to handle the same URL. This is because a match by URL to an annotated controller is considered a strong enough indication of endpoint ownership so that a 405 (METHOD_NOT_ALLOWED), a 415 (UNSUPPORTED_MEDIA_TYPE), or similar response can be sent to the client to help with debugging. For this reason it is recommended to avoid splitting URL handling across an annotated controller and a view controller.

#### 1.11.9. View Resolvers

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-view-resolvers)

The MVC configuration simplifies the registration of view resolvers.

The following Java configuration example configures content negotiation view resolution by using JSP and Jackson as a default `View` for JSON rendering:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(new MappingJackson2JsonView());
        registry.jsp();
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:view-resolvers>
    <mvc:content-negotiation>
        <mvc:default-views>
            <bean class="org.springframework.web.servlet.view.json.MappingJackson2JsonView"/>
        </mvc:default-views>
    </mvc:content-negotiation>
    <mvc:jsp/>
</mvc:view-resolvers>
```

Note, however, that FreeMarker, Tiles, Groovy Markup, and script templates also require configuration of the underlying view technology.

The MVC namespace provides dedicated elements. The following example works with FreeMarker:

```xml
<mvc:view-resolvers>
    <mvc:content-negotiation>
        <mvc:default-views>
            <bean class="org.springframework.web.servlet.view.json.MappingJackson2JsonView"/>
        </mvc:default-views>
    </mvc:content-negotiation>
    <mvc:freemarker cache="false"/>
</mvc:view-resolvers>

<mvc:freemarker-configurer>
    <mvc:template-loader-path location="/freemarker"/>
</mvc:freemarker-configurer>
```

In Java configuration, you can add the respective `Configurer` bean, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(new MappingJackson2JsonView());
        registry.freeMarker().cache(false);
    }

    @Bean
    public FreeMarkerConfigurer freeMarkerConfigurer() {
        FreeMarkerConfigurer configurer = new FreeMarkerConfigurer();
        configurer.setTemplateLoaderPath("/freemarker");
        return configurer;
    }
}
```

#### 1.11.10. Static Resources

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-static-resources)

This option provides a convenient way to serve static resources from a list of [`Resource`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/core/io/Resource.html)-based locations.

In the next example, given a request that starts with `/resources`, the relative path is used to find and serve static resources relative to `/public` under the web application root or on the classpath under `/static`. The resources are served with a one-year future expiration to ensure maximum use of the browser cache and a reduction in HTTP requests made by the browser. The `Last-Modified` information is deduced from `Resource#lastModified` so that HTTP conditional requests are supported with `"Last-Modified"` headers.

The following listing shows how to do so with Java configuration:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/resources/**")
            .addResourceLocations("/public", "classpath:/static/")
            .setCacheControl(CacheControl.maxAge(Duration.ofDays(365)));
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:resources mapping="/resources/**"
    location="/public, classpath:/static/"
    cache-period="31556926" />
```

See also [HTTP caching support for static resources](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-caching-static-resources).

The resource handler also supports a chain of [`ResourceResolver`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/web/servlet/resource/ResourceResolver.html) implementations and [`ResourceTransformer`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/web/servlet/resource/ResourceTransformer.html) implementations, which you can use to create a toolchain for working with optimized resources.

You can use the `VersionResourceResolver` for versioned resource URLs based on an MD5 hash computed from the content, a fixed application version, or other. A `ContentVersionStrategy` (MD5 hash) is a good choice — with some notable exceptions, such as JavaScript resources used with a module loader.

The following example shows how to use `VersionResourceResolver` in Java configuration:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/resources/**")
                .addResourceLocations("/public/")
                .resourceChain(true)
                .addResolver(new VersionResourceResolver().addContentVersionStrategy("/**"));
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:resources mapping="/resources/**" location="/public/">
    <mvc:resource-chain resource-cache="true">
        <mvc:resolvers>
            <mvc:version-resolver>
                <mvc:content-version-strategy patterns="/**"/>
            </mvc:version-resolver>
        </mvc:resolvers>
    </mvc:resource-chain>
</mvc:resources>
```

You can then use `ResourceUrlProvider` to rewrite URLs and apply the full chain of resolvers and transformers — for example, to insert versions. The MVC configuration provides a `ResourceUrlProvider` bean so that it can be injected into others. You can also make the rewrite transparent with the `ResourceUrlEncodingFilter` for Thymeleaf, JSPs, FreeMarker, and others with URL tags that rely on `HttpServletResponse#encodeURL`.

Note that, when using both `EncodedResourceResolver` (for example, for serving gzipped or brotli-encoded resources) and `VersionResourceResolver`, you must register them in this order. That ensures content-based versions are always computed reliably, based on the unencoded file.

[WebJars](https://www.webjars.org/documentation) are also supported through the `WebJarsResourceResolver` which is automatically registered when the `org.webjars:webjars-locator-core` library is present on the classpath. The resolver can re-write URLs to include the version of the jar and can also match against incoming URLs without versions — for example, from `/jquery/jquery.min.js` to `/jquery/1.2.0/jquery.min.js`.

#### 1.11.11. Default Servlet

Spring MVC allows for mapping the `DispatcherServlet` to `/` (thus overriding the mapping of the container’s default Servlet), while still allowing static resource requests to be handled by the container’s default Servlet. It configures a `DefaultServletHttpRequestHandler` with a URL mapping of `/**` and the lowest priority relative to other URL mappings.

This handler forwards all requests to the default Servlet. Therefore, it must remain last in the order of all other URL `HandlerMappings`. That is the case if you use `<mvc:annotation-driven>`. Alternatively, if you set up your own customized `HandlerMapping` instance, be sure to set its `order` property to a value lower than that of the `DefaultServletHttpRequestHandler`, which is `Integer.MAX_VALUE`.

The following example shows how to enable the feature by using the default setup:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:default-servlet-handler/>
```

The caveat to overriding the `/` Servlet mapping is that the `RequestDispatcher` for the default Servlet must be retrieved by name rather than by path. The `DefaultServletHttpRequestHandler` tries to auto-detect the default Servlet for the container at startup time, using a list of known names for most of the major Servlet containers (including Tomcat, Jetty, GlassFish, JBoss, Resin, WebLogic, and WebSphere). If the default Servlet has been custom-configured with a different name, or if a different Servlet container is being used where the default Servlet name is unknown, then you must explicitly provide the default Servlet’s name, as the following example shows:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable("myCustomDefaultServlet");
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:default-servlet-handler default-servlet-name="myCustomDefaultServlet"/>
```

#### 1.11.12. Path Matching

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-path-matching)

You can customize options related to path matching and treatment of the URL. For details on the individual options, see the [`PathMatchConfigurer`](https://docs.spring.io/spring-framework/docs/5.3.8/javadoc-api/org/springframework/web/servlet/config/annotation/PathMatchConfigurer.html) javadoc.

The following example shows how to customize path matching in Java configuration:

Java

Kotlin

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configurePathMatch(PathMatchConfigurer configurer) {
        configurer
            .setPatternParser(new PathPatternParser())
            .addPathPrefix("/api", HandlerTypePredicate.forAnnotation(RestController.class));
    }

    private PathPatternParser patternParser() {
        // ...
    }
}
```

The following example shows how to achieve the same configuration in XML:

```xml
<mvc:annotation-driven>
    <mvc:path-matching
        trailing-slash="false"
        path-helper="pathHelper"
        path-matcher="pathMatcher"/>
</mvc:annotation-driven>

<bean id="pathHelper" class="org.example.app.MyPathHelper"/>
<bean id="pathMatcher" class="org.example.app.MyPathMatcher"/>
```

#### 1.11.13. Advanced Java Config

[WebFlux](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-config-advanced-java)

`@EnableWebMvc` imports `DelegatingWebMvcConfiguration`, which:

- Provides default Spring configuration for Spring MVC applications
- Detects and delegates to `WebMvcConfigurer` implementations to customize that configuration.

For advanced mode, you can remove `@EnableWebMvc` and extend directly from `DelegatingWebMvcConfiguration` instead of implementing `WebMvcConfigurer`, as the following example shows:

Java

Kotlin

```java
@Configuration
public class WebConfig extends DelegatingWebMvcConfiguration {

    // ...
}
```

You can keep existing methods in `WebConfig`, but you can now also override bean declarations from the base class, and you can still have any number of other `WebMvcConfigurer` implementations on the classpath.

#### 1.11.14. Advanced XML Config

The MVC namespace does not have an advanced mode. If you need to customize a property on a bean that you cannot change otherwise, you can use the `BeanPostProcessor` lifecycle hook of the Spring `ApplicationContext`, as the following example shows:

Java

Kotlin

```java
@Component
public class MyPostProcessor implements BeanPostProcessor {

    public Object postProcessBeforeInitialization(Object bean, String name) throws BeansException {
        // ...
    }
}
```

Note that you need to declare `MyPostProcessor` as a bean, either explicitly in XML or by letting it be detected through a `<component-scan/>` declaration.

# 静态资源加载问题

![image-20210628101632010](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210628101632010.png)

```html
../**	上级目录基础上
./**	当前目录基础上
/js/**	绝对路径
```

# Spring 拦截器和过滤器的区别？

https://www.zhihu.com/question/30212464/answer/1786967139

过滤器 和 拦截器 均体现了AOP的编程思想，都可以实现诸如日志记录、登录鉴权等功能，但二者的不同点也是比较多的，接下来一一说明。

## **1、实现原理不同**

过滤器和拦截器 底层实现方式大不相同，过滤器 是基于函数回调的，拦截器 则是基于Java的反射机制（动态代理）实现的。

这里重点说下过滤器！

在我们自定义的过滤器中都会实现一个 doFilter()方法，这个方法有一个FilterChain 参数，而实际上它是一个回调接口。ApplicationFilterChain是它的实现类， 这个实现类内部也有一个 doFilter() 方法就是回调方法。

```text
public interface FilterChain {
    void doFilter(ServletRequest var1, ServletResponse var2) throws IOException, ServletException;
}
```

ApplicationFilterChain里面能拿到我们自定义的xxxFilter类，在其内部回调方法doFilter()里调用各个自定义xxxFilter过滤器，并执行 doFilter() 方法。

```text
public final class ApplicationFilterChain implements FilterChain {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response) {
            ...//省略
            internalDoFilter(request,response);
    }
 
    private void internalDoFilter(ServletRequest request, ServletResponse response){
    if (pos < n) {
            //获取第pos个filter    
            ApplicationFilterConfig filterConfig = filters[pos++];        
            Filter filter = filterConfig.getFilter();
            ...
            filter.doFilter(request, response, this);
        }
    }
 
}
```

而每个xxxFilter 会先执行自身的 doFilter() 过滤逻辑，最后在执行结束前会执行filterChain.doFilter(servletRequest, servletResponse)，也就是回调ApplicationFilterChain的doFilter() 方法，以此循环执行实现函数回调。

```text
  @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        filterChain.doFilter(servletRequest, servletResponse);
    }
```

## **2、使用范围不同**

我们看到过滤器 实现的是 javax.servlet.Filter 接口，而这个接口是在Servlet规范中定义的，也就是说过滤器Filter 的使用要依赖于Tomcat等容器，导致它只能在web程序中使用。

![img](https://pic2.zhimg.com/50/v2-d3481121d481d851fdc8a67ec4580521_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/80/v2-d3481121d481d851fdc8a67ec4580521_720w.jpg?source=1940ef5c)

而拦截器(Interceptor) 它是一个Spring组件，并由Spring容器管理，并不依赖Tomcat等容器，是可以单独使用的。不仅能应用在web程序中，也可以用于Application、Swing等程序中。

![img](https://pic4.zhimg.com/50/v2-33a91948b31d469e15ba04f86c01e64d_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/80/v2-33a91948b31d469e15ba04f86c01e64d_720w.jpg?source=1940ef5c)

## **3、触发时机不同**

过滤器 和 拦截器的触发时机也不同，我们看下边这张图。

![img](https://pic2.zhimg.com/50/v2-66c2ba948283c44f9e07d6af8933caf9_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/80/v2-66c2ba948283c44f9e07d6af8933caf9_720w.jpg?source=1940ef5c)

过滤器Filter是在请求进入容器后，但在进入servlet之前进行预处理，请求结束是在servlet处理完以后。

拦截器 Interceptor 是在请求进入servlet后，在进入Controller之前进行预处理的，Controller 中渲染了对应的视图之后请求结束。

## **4、拦截的请求范围不同**

在上边我们已经同时配置了过滤器和拦截器，再建一个Controller接收请求测试一下。

```text
@Controller
@RequestMapping()
public class Test {

    @RequestMapping("/test1")
    @ResponseBody
    public String test1(String a) {
        System.out.println("我是controller");
        return null;
    }
}
```

项目启动过程中发现，过滤器的init()方法，随着容器的启动进行了初始化。

![img](https://pic1.zhimg.com/50/v2-b4b7ff40f48a1c4901610a87d8974cd9_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/80/v2-b4b7ff40f48a1c4901610a87d8974cd9_720w.jpg?source=1940ef5c)

此时浏览器发送请求，F12 看到居然有两个请求，一个是我们自定义的 Controller 请求，另一个是访问静态图标资源的请求。

![img](https://pic4.zhimg.com/50/v2-dbba2f1605fee3489550cf8d6ed88547_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/80/v2-dbba2f1605fee3489550cf8d6ed88547_720w.jpg?source=1940ef5c)

看到控制台的打印日志如下：

执行顺序 ：Filter 处理中 -> Interceptor 前置 -> 我是controller -> Interceptor 处理中 -> Interceptor 处理后

```text
Filter 处理中
Interceptor 前置
Interceptor 处理中
Interceptor 后置
Filter 处理中
```

过滤器Filter执行了两次，拦截器Interceptor只执行了一次。这是因为过滤器几乎可以对所有进入容器的请求起作用，而拦截器只会对Controller中请求或访问static目录下的资源请求起作用。

## **5、注入Bean情况不同**

在实际的业务场景中，应用到过滤器或拦截器，为处理业务逻辑难免会引入一些service服务。

下边我们分别在过滤器和拦截器中都注入service，看看有什么不同？

```text
@Component
public class TestServiceImpl implements TestService {

    @Override
    public void a() {
        System.out.println("我是方法A");
    }
}
```

过滤器中注入service，发起请求测试一下 ，日志正常打印出“我是方法A”。

```text
@Autowired
    private TestService testService;

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {

        System.out.println("Filter 处理中");
        testService.a();
        filterChain.doFilter(servletRequest, servletResponse);
    }
Filter 处理中
我是方法A
Interceptor 前置
我是controller
Interceptor 处理中
Interceptor 后置
```

在拦截器中注入service，发起请求测试一下 ，竟然TM的报错了，debug跟一下发现注入的service怎么是Null啊？

![img](https://pic2.zhimg.com/50/v2-a2c510a0ce979e35b90033599e900dab_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/80/v2-a2c510a0ce979e35b90033599e900dab_720w.jpg?source=1940ef5c)

这是因为加载顺序导致的问题，拦截器加载的时间点在springcontext之前，而Bean又是由spring进行管理。

> 拦截器：老子今天要进洞房；
> Spring：兄弟别闹，你媳妇我还没生出来呢！

解决方案也很简单，我们在注册拦截器之前，先将Interceptor 手动进行注入。注意：在registry.addInterceptor()注册的是getMyInterceptor() 实例。

```text
@Configuration
public class MyMvcConfig implements WebMvcConfigurer {

    @Bean
    public MyInterceptor getMyInterceptor(){
        System.out.println("注入了MyInterceptor");
        return new MyInterceptor();
    }
 
    @Override
    public void addInterceptors(InterceptorRegistry registry) {

        registry.addInterceptor(getMyInterceptor()).addPathPatterns("/**");
    }
}
```

### **6、控制执行顺序不同**

实际开发过程中，会出现多个过滤器或拦截器同时存在的情况，不过，有时我们希望某个过滤器或拦截器能优先执行，就涉及到它们的执行顺序。

过滤器用@Order注解控制执行顺序，通过@Order控制过滤器的级别，值越小级别越高越先执行。

```text
@Order(Ordered.HIGHEST_PRECEDENCE)
@Component
public class MyFilter2 implements Filter {
```

拦截器默认的执行顺序，就是它的注册顺序，也可以通过Order手动设置控制，值越小越先执行。

```text
 @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new MyInterceptor2()).addPathPatterns("/**").order(2);
        registry.addInterceptor(new MyInterceptor1()).addPathPatterns("/**").order(1);
        registry.addInterceptor(new MyInterceptor()).addPathPatterns("/**").order(3);
    }
```

看到输出结果发现，先声明的拦截器 preHandle() 方法先执行，而postHandle()方法反而会后执行。

postHandle() 方法被调用的顺序跟 preHandle() 居然是相反的！如果实际开发中严格要求执行顺序，那就需要特别注意这一点。

```text
Interceptor1 前置
Interceptor2 前置
Interceptor 前置
我是controller
Interceptor 处理中
Interceptor2 处理中
Interceptor1 处理中
Interceptor 后置
Interceptor2 处理后
Interceptor1 处理后
```

那为什么会这样呢？ 得到答案就只能看源码了，我们要知道controller 中所有的请求都要经过核心组件DispatcherServlet路由，都会执行它的 doDispatch() 方法，而拦截器postHandle()、preHandle()方法便是在其中调用的。

```text
protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
 
        try {
         ...........
            try {
 
                // 获取可以执行当前Handler的适配器
                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());

                // Process last-modified header, if supported by the handler.
                String method = request.getMethod();
                boolean isGet = "GET".equals(method);
                if (isGet || "HEAD".equals(method)) {
                    long lastModified = ha.getLastModified(request, mappedHandler.getHandler());
                    if (logger.isDebugEnabled()) {
                        logger.debug("Last-Modified value for [" + getRequestUri(request) + "] is: " + lastModified);
                    }
                    if (new ServletWebRequest(request, response).checkNotModified(lastModified) && isGet) {
                        return;
                    }
                }
                // 注意： 执行Interceptor中PreHandle()方法
                if (!mappedHandler.applyPreHandle(processedRequest, response)) {
                    return;
                }

                // 注意：执行Handle【包括我们的业务逻辑，当抛出异常时会被Try、catch到】
                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());

                if (asyncManager.isConcurrentHandlingStarted()) {
                    return;
                }
                applyDefaultViewName(processedRequest, mv);

                // 注意：执行Interceptor中PostHandle 方法【抛出异常时无法执行】
                mappedHandler.applyPostHandle(processedRequest, response, mv);
            }
        }
        ...........
    }
```

看看两个方法applyPreHandle(）、applyPostHandle(）具体是如何被调用的，就明白为什么postHandle()、preHandle() 执行顺序是相反的了。

```text
boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception {
        HandlerInterceptor[] interceptors = this.getInterceptors();
        if(!ObjectUtils.isEmpty(interceptors)) {
            for(int i = 0; i < interceptors.length; this.interceptorIndex = i++) {
                HandlerInterceptor interceptor = interceptors[i];
                if(!interceptor.preHandle(request, response, this.handler)) {
                    this.triggerAfterCompletion(request, response, (Exception)null);
                    return false;
                }
            }
        }

        return true;
    }
void applyPostHandle(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv) throws Exception {
        HandlerInterceptor[] interceptors = this.getInterceptors();
        if(!ObjectUtils.isEmpty(interceptors)) {
            for(int i = interceptors.length - 1; i >= 0; --i) {
                HandlerInterceptor interceptor = interceptors[i];
                interceptor.postHandle(request, response, this.handler, mv);
            }
        }
    }
```

发现两个方法中在调用拦截器数组 HandlerInterceptor[] 时，循环的顺序竟然是相反的。。。，导致postHandle()、preHandle() 方法执行的顺序相反。

# MyBatis Generator官方介绍

## Introduction to MyBatis Generator

MyBatis Generator (MBG) is a code generator for MyBatis [MyBatis](http://mybatis.org/). It will generate code for all versions of MyBatis. It will introspect a database table (or many tables) and will generate artifacts that can be used to access the table(s). This lessens the initial nuisance of setting up objects and configuration files to interact with database tables. MBG seeks to make a major impact on the large percentage of database operations that are simple CRUD (Create, Retrieve, Update, Delete). You will still need to hand code SQL and objects for join queries, or stored procedures.

MBG generates code in different styles, and for different languages, depending on how it is configured. For example, MBG can generate Java or Kotlin code. And MBG can generate MyBatis3 compatible XML - althought that is now considered a legacy use of MBG. The newer styles of generated code do not require XML.

Depending on how it is configured, MyBatis Generator may generate:

- Java or Kotlin classes that match the table structure. This may include:

  - a class to match the primary key of the table (if there is a primary key)
  - a class to match the non-primary key fields of the table (except BLOB fields)
  - a class to include the BLOB fields of a table (if the table has BLOB fields)
  - a class to enable dynamic selects, updates, and deletes

  There is an inheritance relationship between these classes as appropriate. Note that the generator may be configured to generate different types of POJO hierarchies - for example, you may choose to generate a single domain object for each table if you so desire.

- In some cases, MBG will generate MyBatis3 Compatible SQL Map XML Files. MBG generates SQL for simple CRUD functions on each table in a configuration. The generated SQL statements include:

  - insert
  - update by primary key
  - update by example (using a dynamic where clause)
  - delete by primary key
  - delete by example (using a dynamic where clause)
  - select by primary key
  - select by example (using a dynamic where clause)
  - count by example

  There are different variations of these statements depending on the structure of the table (for example, if the table doesn't have a primary key, then MBG will not generate an update by primary key function).

- Java or Kotlin client classes, interfaces, and Kotlin extension methods that make appropriate use of the above objects. The generation of client classes is optional. MBG will generate a mapper interface that works with the MyBatis 3.x mapper infrastructure

MyBatis generator is designed to run well in an iterative development environment, and can be included as an Ant task, or a Maven plugin, in a continuous build environment. Important things to note when running MBG iteratively include:

1. MBG will automatically merge XML files if there is an existing file with the same name as the newly generated XML file. MBG will not overwrite any custom changes you make to the XML files it generates. You can run it over and over again without fear of losing custom changes to you XML. MBG will replace any XML elements that were generated in a previous run.
2. MBG will **not** merge Java files, it can either overwrite existing files or save newly generated files with a different unique name. If you make changes to the generated Java files and run MBG iteratively you will have to merge the changes by hand. When run as an [Eclipse](http://www.eclipse.org/) plugin, then MBG can automatically merge Java files.
3. MBG will **not** merge Kotlin files, it can either overwrite existing files or save newly generated files with a different unique name. If you make changes to the generated Kotlin files and run MBG iteratively you will have to merge the changes by hand.

## Running with Eclipse

When running as an Eclipse feature the generator can also merge Java files and save user modifications to the generated Java files. The generator uses the Eclipse Java parser and AST walker to accomplish this. The Eclipse feature also has a few user interface enhancements that make the generator somewhat easier to run. Lastly, the Eclipse feature contributes a full user manual for the generator to the Eclipse help system.

The Eclipse feature can be found on the Eclipse marketplace here: https://marketplace.eclipse.org/content/mybatis-generator.

## Dependencies

MBG has no dependencies beyond the JRE. Java 8 or above is required. Also, a JDBC driver that implements the DatabaseMetaData interface, especially the `getColumns` and `getPrimaryKeys` methods is required.

## Support

Support for MyBatis Generator is provided through the MyBatis user mailing list. You may subscribe to or view the mailing list through Google code here:

> http://groups.google.com/group/mybatis-user

If you think you have found a bug, please ask a question about it on the user list first, before creating a new ticket. If you find a bug, or have a new feature request, you may open a new issue at GitHub here:

> https://github.com/mybatis/generator/issues



# MyBatis Generator-Quick Start Guide

MyBatis Generator (MBG) generates code in different styles depending on how it is configured. This is controlled by specifying the ==targetRuntime== attribute on a ==<context>== configuration element. The table below summarizes the different options.

To get up and running quickly with MyBatis Generator (MBG), follow these steps:

1. Create and fill out a configuration file appropriately (see below for samples)

2. Save the file in some convenient location (like \temp\generatorConfig.xml)

3. Run MBG from the command line with a command like this:

   ```xml
   java -jar mybatis-generator-core-x.x.x.jar -configfile \temp\generatorConfig.xml -overwrite
       
   ```

   This will tell MBG to run using your configuration file. It will also tell MBG to overwrite any existing Java or Kotlin files with the same name. If you want to save any existing files, then omit the `-overwrite` parameter. If there is a conflict, MBG will save the newly generated file with a unique name (e.g. MyClass.java.1).

4. After running MBG, you will need to create or modify the standard MyBatis configuration make use of your newly generated code. See the [Tasks After Running MyBatis Generator](http://mybatis.org/generator/afterRunning.html) page for more information.

## Target Runtime Information and Samples

| Target Runtime     | Comments                                                     | Sample Configuration                                         |
| :----------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| MyBatis3DynamicSql | *This is the default value*Generates Java codeDoes not generate XML - MyBatis3 annotations are used exclusivelyThe generated model objects are "flat" - there is no separate primary key objectThe generated code is dependent on the MyBatis Dynamic SQL LibraryThe amount of generated code is relatively smallThe generated code allows tremendous flexibility in query construction | [Sample Configuration](http://mybatis.org/generator/quickstart.html#MyBatis3DynamicSql) |
| MyBatis3Kotlin     | Generates Kotlin codeDoes not generate XML - MyBatis3 annotations are used exclusivelyThe generated model objects are "flat" - there is no separate primary key objectThe generated code is dependent on the MyBatis Dynamic SQL LibraryThe amount of generated code is relatively smallThe generated code allows tremendous flexibility in query construction | [Sample Configuration](http://mybatis.org/generator/quickstart.html#MyBatis3Kotlin) |
| MyBatis3           | This is the original runtime. Before version 1.3.6 of MBG, most usages of MBG used this style of code.Generates Java codeGenerates MyBatis3 compatible XML and SQL or MyBatis3 compatible annotated interfaces with no XMLThe generated model objects may have a hierarchy with separate primary key objects and/or separate object with BLOB fieldsThe generated code has no external dependenciesThe amount of generated code is very largeThe generated code has limited capabilities for query construction and is difficult to extend | [Sample Configuration](http://mybatis.org/generator/quickstart.html#MyBatis3) |
| MyBatis3Simple     | This is a simplified version of the MyBatis3 runtime.Generates Java codeGenerates MyBatis3 compatible XML and SQL or MyBatis3 compatible annotated interfaces with no XMLThe generated model objects are "flat" - there is no separate primary key objectThe generated code has no external dependenciesThe amount of generated code is relatively smallNo "by example" or "selective" methods are generatedThe generated code does not include methods for dynamic query construction and is difficult to extend | [Sample Configuration](http://mybatis.org/generator/quickstart.html#MyBatis3Simple) |



### Sample Configuration for MyBatis3DynamicSql

```
<!DOCTYPE generatorConfiguration PUBLIC
 "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
 "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
  <context id="dsql" targetRuntime="MyBatis3DynamicSql">
    <jdbcConnection driverClass="org.hsqldb.jdbcDriver"
        connectionURL="jdbc:hsqldb:mem:aname" />

    <javaModelGenerator targetPackage="example.model" targetProject="src/main/java"/>

    <javaClientGenerator targetPackage="example.mapper" targetProject="src/main/java"/>

    <table tableName="FooTable" />
  </context>
</generatorConfiguration>
```



### Sample Configuration for MyBatis3Kotlin

```
<!DOCTYPE generatorConfiguration PUBLIC
 "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
 "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
  <context id="kotlin" targetRuntime="MyBatis3Kotlin">
    <jdbcConnection driverClass="org.hsqldb.jdbcDriver"
        connectionURL="jdbc:hsqldb:mem:aname" />

    <javaModelGenerator targetPackage="example.model" targetProject="src/main/kotlin"/>

    <javaClientGenerator targetPackage="example.mapper" targetProject="src/main/kotlin"/>

    <table tableName="FooTable" />
  </context>
</generatorConfiguration>
```



### Sample Configuration for MyBatis3

```
<!DOCTYPE generatorConfiguration PUBLIC
 "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
 "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
  <context id="simple" targetRuntime="MyBatis3Simple">
    <jdbcConnection driverClass="org.hsqldb.jdbcDriver"
        connectionURL="jdbc:hsqldb:mem:aname" />

    <javaModelGenerator targetPackage="example.model" targetProject="src/main/java"/>

    <sqlMapGenerator targetPackage="example.mapper" targetProject="src/main/resources"/>

    <javaClientGenerator type="XMLMAPPER" targetPackage="example.mapper" targetProject="src/main/java"/>

    <table tableName="FooTable" />
  </context>
</generatorConfiguration>
```



### Sample Configuration for MyBatis3Simple

```
<!DOCTYPE generatorConfiguration PUBLIC
 "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
 "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">
<generatorConfiguration>
  <context id="simple" targetRuntime="MyBatis3Simple">
    <jdbcConnection driverClass="org.hsqldb.jdbcDriver"
        connectionURL="jdbc:hsqldb:mem:aname" />

    <javaModelGenerator targetPackage="example.model" targetProject="src/main/java"/>

    <javaClientGenerator type="ANNOTATEDMAPPER" targetPackage="example.mapper" targetProject="src/main/java"/>

    <table tableName="FooTable" />
  </context>
</generatorConfiguration>
```

# Running MyBatis Generator With Maven

MyBatis Generator (MBG) includes a Maven plugin for integration into a maven build. In keeping with Maven's configuration by convention strategy, including MBG in a Maven build can be very simple. The minimum configuration is shown below:

```
   <project ...>
     ...
     <build>
       ...
       <plugins>
        ...
        <plugin>
          <groupId>org.mybatis.generator</groupId>
          <artifactId>mybatis-generator-maven-plugin</artifactId>
          <version>1.4.0</version>
        </plugin>
        ...
      </plugins>
      ...
    </build>
    ...
  </project>
```

Of course, things are never that easy!

## Maven Goal and Execution

The MBG Maven plugin includes one goal:

- `mybatis-generator:generate`

The goal is not automatically executed by Maven. It can be executed in two ways.

The goal can be executed from the command line with the command:

- `mvn mybatis-generator:generate`

You can pass parameters to the goal with standard Maven command line properties. For example:

- `mvn -Dmybatis.generator.overwrite=true mybatis-generator:generate`

This will run MBG and instruct it to overwrite any existing Java files it may find.

In a continuous build environment, you may want to automatically execute MBG as a part of a Maven build. This can be accomplished by configuring the goal to execute automatically. An example of this is shown below:

```
   <project ...>
     ...
     <build>
       ...
       <plugins>
        ...
        <plugin>
          <groupId>org.mybatis.generator</groupId>
          <artifactId>mybatis-generator-maven-plugin</artifactId>
          <version>1.4.0</version>
          <executions>
            <execution>
              <id>Generate MyBatis Artifacts</id>
              <goals>
                <goal>generate</goal>
              </goals>
            </execution>
          </executions>
        </plugin>
        ...
      </plugins>
      ...
    </build>
    ...
  </project>
```

The MBG plugin is bound to the `generate-sources` phase of a Maven build, so it will execute before the compile step. Also note that MBG generates both Java source files and XML resources. The MBG goal will bind both generated Java files and XML resources to the build and they will both be included in any JAR generated by the build.

## MyBatis Generator Configuration Properties

Any property specified in the POM will be passed into the configuration file and may be used in the normal way. For example:

```
   <project ...>
     ...
     <properties>
       <dao.target.dir>src/main/java</dao.target.dir>
     </properties>
     ...
     <build>
       ...
       <plugins>
        ...
        <plugin>
          <groupId>org.mybatis.generator</groupId>
          <artifactId>mybatis-generator-maven-plugin</artifactId>
          <version>1.4.0</version>
          <executions>
            <execution>
              <id>Generate MyBatis Artifacts</id>
              <goals>
                <goal>generate</goal>
              </goals>
            </execution>
          </executions>
        </plugin>
        ...
      </plugins>
      ...
    </build>
    ...
  </project>
```

In this case, the property may be accessed in the configuration file with the syntax `${dao.target.dir}`.

## Classpath Issues

Initially, the plugin classpath is very limited - it only contains MyBatis generator itself. If you need to add something to the plugin's classpath (for example, a JDBC driver), you can do it by adding dependencies to the plugin configuration like this:

```
   <project ...>
     ...
     <build>
       ...
       <plugins>
        ...
        <plugin>
          <groupId>org.mybatis.generator</groupId>
          <artifactId>mybatis-generator-maven-plugin</artifactId>
          <version>1.4.0</version>
          <executions>
            <execution>
              <id>Generate MyBatis Artifacts</id>
              <goals>
                <goal>generate</goal>
              </goals>
            </execution>
          </executions>
          <dependencies>
            <dependency>
              <groupId>org.hsqldb</groupId>
              <artifactId>hsqldb</artifactId>
              <version>2.3.4</version>
            </dependency>
          </dependencies>
        </plugin>
        ...
      </plugins>
      ...
    </build>
    ...
  </project>
```

If the dependencies you need are already included as dependencies of the project, then you can also use one of the configuration parameters related to the plugin classpath - "includeCompileDependencies" or "includeAllDependencies" see below for details about those properties.

## Parameter Reference

All parameters are optional and most have suitable defaults.

| Parameter                  | Expression                                      | Type             | Comments                                                     |
| :------------------------- | :---------------------------------------------- | :--------------- | :----------------------------------------------------------- |
| configurationFile          | ${mybatis.generator.configurationFile}          | java.io.File     | The location of the XML configuration file.Default value:${basedir}/src/main/resources/generatorConfig.xml |
| contexts                   | ${mybatis.generator.contexts}                   | java.lang.String | A comma delimited list of contexts to use in the current run. Any id specified in the list must exactly match the value of the id attribute of an <context> configuration element. Only ids specified in this list will be active for this run. If this parameter is not specified, then all contexts will be active. |
| jdbcDriver                 | ${mybatis.generator.jdbcDriver}                 | java.lang.String | If you specify a `sqlScript`, then this is the fully qualified JDBC driver class name to use when connecting to the database. |
| jdbcPassword               | ${mybatis.generator.jdbcPassword}               | java.lang.String | If you specify a `sqlScript`, then this is the password to use when connecting to the database. |
| jdbcURL                    | ${mybatis.generator.jdbcURL}                    | java.lang.String | If you specify a `sqlScript`, then this is the JDBC URL to use when connecting to the database. |
| jdbcUserId                 | ${mybatis.generator.jdbcUserId}                 | java.lang.String | If you specify a `sqlScript`, then this is the JDBC user ID to use when connecting to the database. |
| outputDirectory            | ${mybatis.generator.outputDirectory}            | java.io.File     | The directory where files generated by MBG will be placed. This directory is used whenever a `targetProject` in the configuration file is set to the special value "MAVEN" (case sensitive).Default value:${project.build.directory}/generated-sources/mybatis-generator |
| overwrite                  | ${mybatis.generator.overwrite}                  | boolean          | If true, then existing Java files will be overwritten if an existing Java file if found with the same name as a generated file. If not specified, and a Java file already exists with the same name as a generated file, then MBG will write the newly generated Java file to the proper directory with a unique name (e.g. MyClass.java.1, MyClass.java.2, etc.). **Important: MBG will always merge and overwrite XML files.**Default value:false |
| sqlScript                  | ${mybatis.generator.sqlScript}                  | java.lang.String | Location of a SQL script file to run before generating code. If null, then no script will be run. If not null, then `jdbcDriver`, `jdbcURL` must be supplied also. In addition, `jdbcUserId` and `jdbcPassword` may be supplied if the database requires authentication.Value can be specified as a location in the file system or, if prefixed with "classpath:" a location on the build classpath. |
| tableNames                 | ${mybatis.generator.tableNames}                 | java.lang.String | If specified, then this is a comma delimited list of tables to use in the current run. Any table specified in the list must exactly match the fully qualified table name specified in a <table> configuration element. Only tables specified in this list will be active for this run. If this argument is not specified, then all tables will be active. Specify table names as:`tableschema.tablecatalog..tableetc.` |
| verbose                    | ${mybatis.generator.verbose}                    | boolean          | If true, then MBG will write progress messages to the build log. |
| includeCompileDependencies | ${mybatis.generator.includeCompileDependencies} | boolean          | If true, then dependencies with scope "compile", "provided", and "system" will be added to the generator's classpath. |
| includeAllDependencies     | ${mybatis.generator.includeAllDependencies}     | boolean          | If true, then dependencies with any scope will be added to the generator's classpath. |

## Interpretation of targetProject

The `targetProject` attribute of the generator configurations is interpreted differently when running with Maven. If set to the special value "MAVEN" (case sensitive), then `targetProject` will be set to the plugin's output directory, and that directory will be created if it doesn't already exist. If not set to "MAVEN", then `targetProject` will be interpreted as normal by MBG - it must be set to a directory that already exists.



# 食用方式

第一步，在pom.xml中加入

```xml
            <plugin>
                <groupId>org.mybatis.generator</groupId>
                <artifactId>mybatis-generator-maven-plugin</artifactId>
                <version>1.4.0</version>
                <dependencies>
                    <dependency>
                        <groupId>mysql</groupId>
                        <artifactId>mysql-connector-java</artifactId>
                        <version>8.0.25</version>
                    </dependency>
                </dependencies>
            </plugin>
```

第二步，在${basedir}/src/main/resources/generatorConfig.xml按照目录创建generatorConfig.xml并且如下：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE generatorConfiguration
        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd">

<generatorConfiguration>
    <context id="DB2Tables" targetRuntime="MyBatis3">
        <jdbcConnection driverClass="com.mysql.cj.jdbc.Driver"
                        connectionURL="jdbc:mysql://localhost:3306/oneucommunity?useUnicode=true&amp;characterEncoding=utf-8"
                        userId="root"
                        password="root">
        </jdbcConnection>

        <javaTypeResolver >
            <property name="forceBigDecimals" value="false" />
        </javaTypeResolver>

        <javaModelGenerator targetPackage="top.onepecent.oneu.model" targetProject="src\main\java">
            <property name="enableSubPackages" value="true" />
            <property name="trimStrings" value="true" />
        </javaModelGenerator>

        <sqlMapGenerator targetPackage="mapper"  targetProject="src\main\resources">
            <property name="enableSubPackages" value="true" />
        </sqlMapGenerator>

        <javaClientGenerator type="XMLMAPPER" targetPackage="top.onepecent.oneu.mapper"  targetProject="src\main\java">
            <property name="enableSubPackages" value="true" />
        </javaClientGenerator>

        <table tableName="user" domainObjectName="User" >
<!--            <property name="useActualColumnNames" value="true"/>-->
        </table>
    </context>
</generatorConfiguration>
```

可以通过官网（[MyBatis Generator Core – MyBatis Generator XML Configuration File Reference](http://mybatis.org/generator/configreference/xmlconfig.html#)）了解每个标签的含义！

![image-20210628201416243](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210628201416243.png)



# 指令

- mvn -Dmybatis.generator.overwrite=true mybatis-generator:generate

在启动类中加入注解：

```java
@MapperScan(basePackages = "top.onepecent.oneu.mapper")
```

或者简写

```java
@MapperScan("top.onepecent.oneu.mapper")
```



在application.properties中加入

```xml
mybatis.type-aliases-package=top.onepecent.oneu.model
mybatis.mapper-locations=classpath:mapper/*.xml
```



接下来就是食用了：

```java
UserExample userExample = new UserExample();
userExample.createCriteria().andTokenEqualTo(token);
List<User> users = userMapper.selectByExample(userExample);
if (users.size() != 0) {
     request.getSession().setAttribute("user", users.get(0));
}
break;
```





# 加入了分页（包含解决bug）

在generatorConfig.xml的context标签中加入

```xml
<plugin type="org.mybatis.generator.plugins.RowBoundsPlugin"></plugin>
```

运行

然后会可能出现bug

[Spring Boot + Mybatis——RowBoundsPlugin造成的[Mapped Statements collection already contains value\]解决方案_无限迭代中......-CSDN博客](https://blog.csdn.net/weixin_43272781/article/details/104175438)

解决方法一：==删除多余的**selectByExampleWithRowbounds**==以后启动 **Spring Boot** 会找不到 **Blob_Column_List** ==再删除 **selectByExampleWithBLOBsWithRowbounds 即可。**==



selectByExampleWithRowbounds这个方法有的表会生成好多个
问题:

 生成的过程中发现xml中selectByExampleWithRowbounds这个方法有的表会生成好多个
 一张表新增了一个字段，发现生成的时候没有生成这个字段。
后来上网搜，收到了这篇文章：https://www.jianshu.com/p/dbeeac29ff27
解决方法二：

​	在连接字符串后面添加==nullCatalogMeansCurrent=true==
原来我jdbc连接串的数据库没起作用，MybatisGenerator取的是最近一个数据库的表（我数据库有很多database），所以没取到目标的数据库的表
使用mysql驱动连接mysql时，指定数据库是用catalog，而不是schema。
那nullCatalogMeansCurrent就好理解了，因为之前配置的是schema=“piwik”，那么catalog就是null了，null的话就means current，就取当前的catalog，这个catalog就是连接串jdbc:mysql://localhost:3306/piwik里的“piwik”。

解决方法三：

在generatorConfig.xml中的table属性中添加catalog，如下：

```xml
<table catalog="mz" tableName="mc_common_data" domainObjectName="McCommonData" ></table>
但是问题是会建立新的包，所以还是第一种方法好用
```



# spring中的事务

@Transactional





# 页面回复-不刷新页面实现登录

```javascript
function post() {
    let questionId = $("#question_id").val();
    let content = $("#comment_content").val();
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/comment",
        data: JSON.stringify({
            "parentId": questionId,
            "content": content,
            "type": 1
        }),
        success: function (response) {
            if (response.code == 200) {
                $("#comment_section").hide();
            } else {
                if (response.code == 2003) {
                    let isAccept = confirm(response.message);
                    if (isAccept){
                        window.open("https://gitee.com/oauth/authorize?client_id=dff6e34bfb612c86793b6264be6ba60a8bb3511d16cd47d52e06632a7aa0cc29&redirect_uri=http://localhost:8080/callback&response_type=code&state=1");
                        window.localStorage.setItem("closable",true);
                    }
                } else {
                    alert(response.message);
                }
            }
        },
        dataType: "json"
    });
}
```

==window.localStorage.setItem("closable",true);==设置一个localStorage即可

## localStorage

### 1、html5几种存储形式

```javascript
   本地存储（localStorage && sessionStorage）
   离线缓存（application cache）
   indexedDB 和 webSQL
```

### 2、localStorage && sessionStorage

```javascript
过期时间：localStorage 永久存储，永不失效除非手动删除
sessionStorage 浏览器重新打开后就消失了
大小：每个域名是5M
```

### 3、localStorage API和sessionStorage API一致

```javascript
getItem //取记录
setIten//设置记录
removeItem//移除记录
key//取key所对应的值
clear//清除记录
```

### 4、存储的内容

```javascript
   数组，图片，json，样式，脚本。。。（只要是能序列化成字符串的内容都可以存储）
```

### 5、localStorage实例

```javascript
<!DOCTYPE>   
<head>   
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   
<meta http-equiv="Access-Control-Allow-Origin" content="anonymous">   
<title>locstorage 图片存储</title>   
</head>   
<body>   
</body>   
</html>   
<script>   
   var src='images/1.png';//这里一定要在服务器上运行，图片要是当前服务器的图片！   
   function set(key){   
   var img = document.createElement('img');//创建图片元素   
   img.addEventListener('load',function(){//绑定加载时间   
   var imgcavens = document.createElement('canvas');   
   imgcontent = imgcavens.getContext('2d');   
   imgcavens.width = this.width;//设置画布大小为图片本身的大小   
   imgcavens.height = this.height;   
   imgcontent.drawImage(this,0,0,this.width,this.height);   
   var imgAsDataUrl = imgcavens.toDataURL('image/png');//这个方法一定要在服务器上运行/*对图像数据做出修改以后，可以使用toDataURL方法，将Canvas数据重新转化成一般的图像文件形式。function convertCanvasToImage(canvas) {  var image = new Image();  image.src = canvas.toDataURL("image/png");  return image;}上面的代码将Canvas数据，转化成PNG data URI。*/  try{   
     localStorage.setItem(key,imgAsDataUrl);//保存图片地址   
   }catch(e)   
   {   
    console.log("storageFaild: "+e);//错误信息   
   }   
   },false)   
   img.src = src;//指定需要存储的图片地址   
   }   
   function get(key){   
    var srcStr = localStorage.getItem(key);//获取本地存储的元素   
    var imgobj = document.createElement('img');   
    imgobj.src = srcStr;//指定图片路径   
    document.body.appendChild(imgobj);//在页面中添加元素   
   }   
   </script>  
   //此时无论如何刷新页面和重新打开浏览器，刚才存储的图片都是存在的，除非手动删除！
```

### 6、locstorage 过期策略

由于html5没有给本地存储设置过期策略，那么在处理图片的过期策略的时候可以编写自己过期策略程序，如下：

```javascript
<!DOCTYPE>   
<head>   
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   
<meta http-equiv="Access-Control-Allow-Origin" content="anonymous">   
<title>locstorage 过期策略</title>   
</head>   
<body>   
</body>   
</html>   
<script>   
function set(key,value){   
 var curtime = new Date().getTime();//获取当前时间   
 localStorage.setItem(key,JSON.stringify({val:value,time:curtime}));//转换成json字符串序列 /*  说明：  JSON.parse用于从一个字符串中解析出json对象,如  var str = '{"name":"huangxiaojian","age":"23"}'  结果：  JSON.parse(str)  Object    age: "23"    name: "huangxiaojian"    __proto__: Object   
 注意：单引号写在{}外，每个属性名都必须用双引号，否则会抛出异常。  JSON.stringify()用于从一个对象解析出字符串，如  var a = {a:1,b:2}  结果：  JSON.stringify(a)  "{"a":1,"b":2}" */}
```

```javascript
function get(key,exp)//exp是设置的过期时间   
{   
  var val = localStorage.getItem(key);//获取存储的元素   
  var dataobj = JSON.parse(val);//解析出json对象   
if(new Date().getTime() - dataobj.time > exp)//如果当前时间-减去存储的元素在创建时候设置的时间 > 过期时间   
{   
  console.log("expires");//提示过期   
}   
else{   
  console.log("val="+dataobj.val);   
}   
}   
</script>
如需转载，请注明文章出处和来源网址：http://www.divcss5.com/html5/h50490.shtml
```





# Java8  lamda

获取去重的评论人

```java
UserExample userExample = new UserExample();
        userExample.createCriteria().andIdIn(userIds);
        List<User> users = userMapper.selectByExample(userExample);
        Map<Long, User> userMap = users.stream().collect(Collectors.toMap(user -> user.getId(), user -> user));//java8-----stream()?

        List<CommentDTO> commentDTOS = comments.stream().map(comment -> {
            CommentDTO commentDTO = new CommentDTO();//java8-----stream()?
            BeanUtils.copyProperties(comment, commentDTO);
            commentDTO.setUser(userMap.get(comment.getCommentator()));
            return commentDTO;
        }).collect(Collectors.toList());
```



```xml
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.9</version>
</dependency>
```



# Moment.js(JavaScript 日期处理类库)

[Moment.js 中文网 (momentjs.cn)](http://momentjs.cn/)

![image-20210704121925833](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210704121925833.png)

# Tabbed Postman - REST Client

![image-20210705083148180](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210705083148180.png)

浏览器插件----用于调试与接口模拟

# Bootstrap（前端框架）

https://v3.bootcss.com/



# thymeleaf取List中前10条数据

```html
<ul class="question-related">
  <li th:each="related,relatedStat:${relatedQuestions}" th:if="${relatedStat.count}<10">
     <a th:href="@{'/question/'+${related.getId()}}" th:text="${related.getTitle()}"></a>
  </li>
</ul>
```

其中th:each第二个变量就是迭代的状态变量，本文命名的是relatedStat。

状态变量有如下属性：
index: 当前迭代索引，从0开始。
count: 当前迭代索引，从1开始。
size: 迭代变量中的元素总数。
current: 每个迭代的iter变量, 和本文中的item一样。
even/odd: 当前迭代是偶数还是奇数，布尔值。
first: 在当前的迭代中是否是第一个，布尔值。
last: 在当前的迭代中是否是最后一个，布尔值。

使用 th:if 加 count比较 即可约束后续内容显示。





# Editor.md

https://pandao.github.io/editor.md/

![image-20210706141017573](C:\Users\Dizzy\AppData\Roaming\Typora\typora-user-images\image-20210706141017573.png)

使用方法：

```markdown
<link rel="stylesheet" href="editormd/css/editormd.css" />
<div id="test-editor">
    <textarea style="display:none;">### 关于 Editor.md

**Editor.md** 是一款开源的、可嵌入的 Markdown 在线编辑器（组件），基于 CodeMirror、jQuery 和 Marked 构建。
    </textarea>
</div>
<script src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
<script src="editormd/editormd.min.js"></script>
<script type="text/javascript">
    $(function() {
        var editor = editormd("test-editor", {
            // width  : "100%",
            // height : "100%",
            path   : "editormd/lib/"
        });
    });
</script>
```

较为详细的文档：

[pandao/editor.md: The open source embeddable online markdown editor (component). (github.com)](https://github.com/pandao/editor.md)

·Markdown to HTML

·HTML to Markdown



# 阿里图标管理交流平台

[iconfont-阿里巴巴矢量图标库](https://www.iconfont.cn/home/index)

